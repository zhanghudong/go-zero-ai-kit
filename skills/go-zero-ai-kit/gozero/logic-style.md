# Logic 实现风格（严格版）

目标：在 goctl scaffold 的基础上，实现清晰、可维护、可追踪的业务逻辑。

## 结构要求
- 逻辑函数签名保持 goctl 生成形态不变。
- 使用 `logx.WithContext(ctx)` 初始化 Logger。
- 入口先做必要前置检查，再进入核心流程。
- 核心流程采用“分步注释”组织，形如：
  - `// ========== 步骤1：... ==========`
- 外部调用 + 数据映射建议拆成私有方法（如 `getXxxDetail`）。

## 错误处理
- 记录业务上下文字段 + 错误信息。
- 返回上层可识别错误（业务错误 / 系统错误区分）。
- 不吞错误，不打印后直接返回 `nil`。

## 可读性
- 业务路由逻辑用 `switch` 或清晰函数拆分。
- 复杂逻辑拆分为私有方法，放在同文件下。
- 不在 handler 中写业务逻辑，全部放 logic 层。

## 日志风格
- `Errorw` 用于关键失败场景。
- `Infow` 用于关键状态迁移或外部调用完成。
- 日志字段必须包含业务主键。
- 外部调用失败必须包含调用参数或主键（如 `hotel_id`, `sids`）。

## 输入来源优先级
- 详设文档 > .api > .sql
- 详设与 .api 不一致时，以详设为准并记录 Warning。

## 输入校验规则（严格）
- **不做 `req == nil` 判断**（goctl 生成调用不会传入 nil）。
- **不重复做 .api 已声明的必填校验**。
- 仅在更新类接口中，对“可选字段是否为空”做更新判断。
- 分页参数遵循 .api 默认值，不额外判断 `page <= 0`。
- `pageSize` 只做上限裁剪（`MaxPageSize`）。

## 查询构建规则
- `CountBuilder` 使用 `*`。
- `squirrel` 条件字段统一加反引号（如 `` `tenant_id` ``）。

## 时间处理（统一工具包）
- 统一使用项目公共时间工具包（如 `timeutil`）进行解析与格式化。
- 列表/详情返回时间字段时优先使用 `timeutil.FormatDateTime` 等封装方法。

## 列表映射
- 列表返回优先使用“预分配 + 按索引赋值”的方式：
  - `resp.List = make([]T, len(rows))`
  - `resp.List[i] = ...`
- 布尔/枚举字段优先与常量对齐（如 `constant.MockTrue`）。
- 若常量不存在，应在 `pkg/constant` 中新增并统一使用。
